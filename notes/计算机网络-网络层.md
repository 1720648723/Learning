# 四、网络层
* **传输单位**：数据报

* **功能**：组包[传输分组用]、拆包[接收分组用]、路由选择

* **协议**：IP、CIDR、NAT、IP相关的三个协议：ARP、DHCP、ICMP；三种常用路由选择协议：RIP、OSPF、BGP

  ****


* **问：路由器（Router）的功能？**

* **答**：功能包括：路由选择，分组转发。当中继系统是中继器或网桥时，一般不称为网络互连，这仅仅是把网络扩大了，扔然是一个网络。互联网都是指路由器进行互连的网络。

  ****

 * **问：转发和路由选择是同一概念，都是指当交换结点收到分组后，根据其目的地址查找转发表，将该分组发送出去？**

 * **答**：错误。转发 发生在 桥接器 或 路由器 上，分组到达桥接器或路由器后，由桥接器或路由器检查分组地址并将它转发到一个邻接的局域网(LAN)上。路由选择 是指选择通过 互连网络从源 节点向目的节点传输信息的路线，包括多个路由器的选择，在确定最佳路径的过程中，路由选择算法需要初始化和维护路由选择表（routingtable）。路由选择表中包含的路由选择信息根据路由选择算法的不同而不同。一般在 路由表 中包括这样一些信息：目的 网络地址 ，相关 网络节点 ，对某条路径满意程度，预期路径信息等。 路由器 之间传输多种信息来维护路由选择表，修正路由消息就是最常见的一种。修正路由消息通常是由全部或部分路由选择表组成，路由器通过分析来自所有其他路由器的最新消息构造一个完整的 网络拓扑结构 详图。链路状态广播便是一种路由修正信息

   ****

 * **问：网络层尽最大努力交付？**

 * **答**：网络层**不能保证**发送出来的 IP 数据报，一定无差错交付、在某一规定时间内交付、按发送顺序交付、不重复交付到目的主机，这些他都**不能保证**！能做的就是不故意丢弃，如果检测出**首部校验和**有错误，或网络信息量过大，或路由器无缓存空闲空间，就会丢弃它。

   ****

* **问：虚电路？**

* **答**：参考传*输层的 TCP 连接和虚电路的区别。*

  ****

* **问：路由选择？**

* **答**：网络错综复杂，选择好的路由还是很关键的，有两大类，静态路由选择和动态路由选择，我们从字面上看也知道，静态路由选择简单开销小，但不能适应网络状态变化，适合很小的网络，手动配置路由；那我们更多的使用肯定是动态路由，动态调整听起来就很厉害，因此它主要分为两种基本类型*距离-向量路由算法（RIP）*和*链路状态路由算法（OSPF）*。RIP：简单点说就是经过的路由器越少，那么我就推荐这条路线给你用。OSPF：则是每个路由器都有一份世界地图，这样肯定好找，但是要经常更新此地图。OSPF适合于在大型的、动态的互连网上使用，而RIP适合于在小型的、静态的互连网上使用。

  ****

* **问：IP地址的分类？**

* **答**：五类，ABC 基本类 DE 保留。
  
**A类**：网络地址8位，0开头；地址(0.0.0.0 - 127.255.255.255)
  **B类**：网络地址16位，10开头；地址(128.0.0.0 - 191.255.255.255)
**C类**：网络地址24位，110开头；地址(192.0.0.0 - 223.255.255.255)
  
**D类**：不分网络地址和主机地址，是一个保留地址，1110开头；地址(224.0.0.0 - 239.255.255.255)
  
  **E类**：不分网络地址和主机地址，1111开头；地址(240.0.0.0 - 255.255.255.255)，为将来使用，看来是没机会了，因为 128 的 ip 地址已经出来了。
  
**注意**：除网络地址位数后，其余全 0 的是网络号，全 1 的是广播地址，其余才可以当做主机地址分配。
  

  **0.0.0.0**：保留地址，意思是本网络，A 类网络地址少一个。

  **127.x.x.x**：127 开头的 IP 地址作为环回地址，用来测试软件。使用这个地址时，分组永远不会离开这个机器，A 类网络少一个。
  
  **D类**：组播地址，D 类地址不能出现在 IP 报文的源 IP 地址字段。组播换中，数据包的目的地址不止一个，而是一组，一旦有信息流向组地址，数据就开始向接受者传输，组中成员都能接受到数据包，组播中的成员是动态的。
  
**问：单播、组播、广播？**
  
**答**：分别指一对一，一对一组，一对所有的通信模式。
  

  
**NAT[ 专用IP地址 ]**：如果作为目的地址，是不会在网络上传送的，因为这是需要被重复使用的内部IP地址，因特网规定：A类网络:10.0.0.1-10.255.255.254; 1个A类网络作为专用网络
  B类网络:172.16.0.1-172.31.255.254；16个B类网络作为专用网络
  C类网络:192.168.0.0-192.168.255.0; 256个C类网络作为专用网络

  

  **解释 NAT**：因为某些机构并不需要连接到因特网，只需要内部通信，这样就不需要给每台电脑都分配全球唯一 IP 了，可以参考 IP 地址的分类。这些内部 IP 地址每个公司都可以内部设定，如果需要那么会自动转化为全球 IP 地址，因此一个公司只需要少量的 IP 地址就可以了。
  
  
  
  **练习：下面哪一个地址不能用作某个局域网内网IP？**
  A. 192.168.201.114 B. 172.16.4.25 **C. 127.0.0.1** D. 10.0.0.1
  
  ****
  
* **问：168.192.33.124/26 （CIDR）所对应的子网掩码是什么？**

* **答**：255.255.255.192。使用了CIDR（无分类编址），这是为了解决IP地址耗尽而提出的，斜线后的数字 26 表示子网掩码 1 的数量，从左到右 26 个 1，对应的子网掩码如答案。

  ****

**IP相关的三个协议：ARP、RARP、DHCP、ICMP**

* **问：ARP（IP 地址 -> MAC 地址映射表）RARP（MAC 地址 -> IP 地址 映射表）后者就不介绍了？**

* **答**：里面存放的是**所有局域网**上的各主机和路由器的 IP 地址到硬件地址的映射表，ARP 的职责就是动态的维护该表。**工作方式：**当源主机向本局域网上的某个主机发送 IP 分组时，应先在 ARP 缓存中查找 IP 地址对应的 MAC 地址，如果没有，广播 ARP 请求分组，获得响应后写入 ARP 缓存。

  ****

* **问：DHCP（动态主机配置协议）？**

* **答**：ARP 可以将 IP 地址转换为物理地址，那么有什么可以将物理地址转换为 IP 地址呢，答案就是 DHCP 拥有这种功能，且会动态给主机分配 IP 地址

  ****

* **问：ICMP？**

* **答**：主机在发送数据报时，经常会由于各种原因反馈回错误，如检测出错误的路由器，那么它会反馈给主机，因此 ICMP 可根据错误类型，重发失败的数据报。一般包括两大类：ICMP 差错报告报文（终点不可达、源站抑制、时间超时、参数问题、改变路由），和 ICMP 询问报文。


